About
----------
Everything you need to host Apple NetBoot services on Linux, provided in a single container.  Uses BSDPy, pTFTPd, pypy, and nginx.

Building
----------
Run the _build-script.sh_.

This script is interactive and will download items and create a server “package root” as a tarball.  Site-specific configuration is embedded in the _init-script.sh_ script in the tarball.

The _build-script.sh_ needs Internet access.  It grabs current versions of the open source items it needs from the Internet.

Installing
----------
1. Copy the package root tarball to the target server and expand it in a directory of your choosing.
2. Run the _init-script.sh_ with the _install_ argument as root; for example:
<pre>
tar -xvf netboot-server-container-2016.08.tgz
sudo ./netboot-server-container/init-script.sh install
</pre>
When installing, the script will ask for two configuration parameters:
   * The path to the NetBoot sharepoint; that is, the folder with the _.nbi_ folders inside of it.
   * The network interface (e.g., eth0) that the BSDPy server will use.
3. To upgrade or install a new version of the package, simpy repeat the installation steps above.

Authors & Sources
----------
### By GSU ###
   * The following items were created by Gerrit DeWitt (gdewitt@gsu.edu).
      * This file, _ReadMe.md_
      * Other notes in the _Documentation_ directory
      * The _build-script.sh_
      * The _init-script-template.sh_ (and, consequently, the _init-script.sh_ as generated by the _build-script.sh_)
      * The _nginx-site-default.template_ file, which is copied into the package root by the _build-script.sh_ and then modified by the _init-script.sh_.  It is simply facts and information, standard nginx config directives.
   * The _bsdpy_patches.patch_ file is a difference capture of a derivative work created by Gerrit DeWitt (gdewitt@gsu.edu) from _bsdpserver.py_.
   * This container was compiled by Gerrit DeWitt (gdewitt@gsu.edu) using other open source items.  For license terms, authors, and references, refer to the Sources section.

### General Reference Notes and Public How-To ###
1. Using BSDPy and NetBoot images
   * http://manu.agat.net/dotclear/index.php/post/2014/04/29/OSX%3A-what-is-Netboot-and-using-it-with-linux
2. _nginx_
   * SELinux Considerations: http://serverfault.com/questions/18578/apache-throwing-403-on-serving-images-from-an-nfs-share
   * SELinux Considerations: http://unix.stackexchange.com/questions/196907/proxy-nginx-shows-a-bad-gateway-error
   * Accepting Network Connections: http://unix.stackexchange.com/questions/196907/proxy-nginx-shows-a-bad-gateway-error
   * Signalling nginx: https://www.nginx.com/resources/wiki/start/topics/tutorials/commandline/
   * http://www.itzgeek.com/how-tos/linux/centos-how-tos/install-nginx-on-centos-7-rhel-7.html
3. Creating _init_ Scripts
   * http://www.tldp.org/HOWTO/HighQuality-Apps-HOWTO/boot.html
   * https://blog.hazrulnizam.com/create-init-script-centos-6/
   * https://gist.github.com/TheMengzor/968e5ea87e99d9c41782
   * https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Deployment_Guide/s2-services-chkconfig.html
4. Extracting RPM Contents
   * http://blog.packagecloud.io/eng/2015/10/13/inspect-extract-contents-rpm-packages/
   * http://www.cyberciti.biz/tips/how-to-extract-an-rpm-package-without-installing-it.html
   * http://stackoverflow.com/questions/18787375/how-do-i-extract-the-contents-of-an-rpm
5. Diffs and Patches
   * https://docs.moodle.org/dev/How_to_create_a_patch
   * http://www.thegeekstuff.com/2014/12/patch-command-examples/
6. Misc
   * http://stackoverflow.com/questions/584894/sed-scripting-environment-variable-substitution
   * http://stackoverflow.com/questions/651038/how-do-you-clone-a-git-repository-into-a-specific-folder
   * http://docs.python-guide.org/en/latest/dev/virtualenvs/
   * http://stackoverflow.com/questions/1063347/passing-arrays-as-parameters-in-bash
   * http://www.joeldare.com/wiki/linux:wget_to_stdout
   * https://github.com/pypa/virtualenv/issues/92
   * http://serverfault.com/questions/529287/rsync-creates-a-directory-with-the-same-name-inside-of-destination-directory
   * https://virtualenv.pypa.io/en/stable/reference/
   * http://wiki.bash-hackers.org/howto/conffile
   * http://unix.stackexchange.com/questions/74185/how-can-i-prevent-grep-from-showing-up-in-ps-results


### Software ###
1. PyPy Runtime: Created by various authors
   * https://github.com/squeaky-pl/portable-pypy#portable-pypy-distribution-for-linux and http://doc.pypy.org/en/latest/
   * Serves as a standalone, pre-compiled Python 2.7 runtime so we do not have to depend on the version of Python included with the base OS.
   * License for _pypy_: MIT, https://bitbucket.org/pypy/pypy/src/default/LICENSE
   * License for Python 2.7: Python License, https://www.python.org/download/releases/2.7/license/
   * This pypy runtime includes several standard Python modules (the standard Python library).
      * Modules are stored in the _site-packages_ directory in each Python virtual environment.
      * Many standard modules use the Python License.
      * For terms specific to certain modules, or for author information, search for the module by name at _docs.python.org_ or at the Python Package Index site (_pypi.python.org_).
2. BSDPy Server: Created by Pepijn Bruienne
   * https://bitbucket.org/bruienne/bsdpy/src and https://github.com/bruienne/bsdpy
   * License: Apache License 2.0  (Copyright 2014 The Regents of the University of Michigan)
   * Dependency for BSDPy: _pydhcplib_: Created by Mathieu Ignacio
      * https://github.com/bruienne/pydhcplib (This fork is used by BSDPy.)
      * Original project: http://pydhcplib.tuxfamily.org/pmwiki/
      * License: GPLv3
   * Dependency for BSDPy: _docopt_: Created by Vladimir Keleshev
      * https://pypi.python.org/pypi/docopt and https://github.com/docopt/docopt
      * License: MIT, https://github.com/docopt/docopt/blob/master/LICENSE-MIT
3. pTFTPd Server: Written and maintained by Maxime Petazzoni et al.
   * https://github.com/mpetazzoni/ptftpd and https://github.com/mpetazzoni/ptftpd/blob/master/AUTHORS
   * License: GPLv3, https://github.com/mpetazzoni/ptftpd/blob/master/COPYING
   * Dependency for pTFTPd: _netifaces_: Created by Alastair Houghton
      * https://pypi.python.org/pypi/netifaces and https://bitbucket.org/al45tair/netifaces
      * License: MIT, https://bitbucket.org/al45tair/netifaces
4. nginx: Written and maintained by Igor Sysoev and Nginx, Inc.
   * http://nginx.org/en/, http://nginx.org/packages/rhel/6/x86_64/RPMS/
   * License: BSD, http://nginx.org/LICENSE
   
Organization
----------
Top level items in this repository are:
* _build-script.sh_: A shell script that builds a “container” for deployment to a server.  It needs Internet access to download the various components.
* _init-script-template.sh_: A shell script that serves as a template for the _init-script.sh_ included in the container that's produced.
* The _nginx-site-default.template_: Simple nginx config file copied into the container.
* _bsdpy_patches.patch_: A few patches for bsdpy to handle uncaught KeyErrors.  Applied at build time to the _bsdpserver.py_ file.
* _ReadMe.md_ and _Documentation_: This file and other documentation.

When built, the NetBoot server container has the following layout:
* _build.log_: The build log created by the _build-script.sh_.
* _init-script.sh_: The shell script responsible for loading and installing the software.  Created by the _build-script.sh_ from _init-script-template.sh_.
* _container.conf_: Config data read and written by the _init-script.sh_.
* _bsdpy_virtualenv_: Portable pypy virtual environment for BSDPy and its dependencies.
* _ptftpd_virtualenv_: Portable pypy virtual environment for pTFTPd and its dependencies.
* _nginx_: “chroot” environment for nginx

Methods
----------
### Python Dependencies ###
Dependencies are those Python modules on which BSDPy and pTFTPd rely that are not included with the pypy runtime by default.  The _build-script.sh_ creates Python virtual environments, downloading and installing the necessary dependencies in each.  The Python virtual environment is created using tools included with _pypy_; _pip_ is the method for obtaining the dependencies.    